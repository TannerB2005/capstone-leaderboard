<header class="lb-header">
  <h2>Carrier Overview</h2>
  <div class="meta">
    <form class="filter-form" (submit)="$event.preventDefault()">
      <label class="visually-hidden" for="ovFilterBox">Filter</label>
      <div class="filter-controls">
        <input
          id="ovFilterBox"
          type="text"
          placeholder="Filter by carrier or type..."
          [(ngModel)]="filterText"
          name="filter"
          aria-label="Filter carriers"
        />
        <button
          type="button"
          class="clear-btn"
          *ngIf="filterText"
          (click)="clearFilter()"
          aria-label="Clear filter">×</button>
      </div>
    </form>

    <button
      class="sort-info actionable"
      type="button"
      (click)="handleSortInfoClick($event)"
      title="Click to cycle sort field; Shift+Click to toggle direction">
      Sorted by {{ sortField }} ({{ sortDir }})
    </button>

    <div class="spacer"></div>

    <button [class.active]="store.selectedType() === 'ALL'" (click)="store.setType('ALL')">All</button>
    <button [class.active]="store.selectedType() === 'LTL'" (click)="store.setType('LTL')">LTL</button>
    <button [class.active]="store.selectedType() === 'TL'"  (click)="store.setType('TL')">TL</button>
    @if (store.selectedCarrierId() !== null) {
      <button class="link" (click)="store.clearSelection()">Clear selection</button>
    }
  </div>
</header>

<div class="table-wrapper" role="table" aria-label="Carrier overview leaderboard">
  <div class="row header" role="row">
    <div class="cell rank" role="columnheader">#</div>
    <button class="cell carrier"   (click)="toggleSort('carrier')"     role="columnheader" [attr.aria-sort]="ariaSort('carrier')">Carrier</button>
    <button class="cell type"      (click)="toggleSort('type')"        role="columnheader" [attr.aria-sort]="ariaSort('type')">Type</button>
    <button class="cell quotes"    (click)="toggleSort('quotes')"      role="columnheader" [attr.aria-sort]="ariaSort('quotes')">Quotes</button>
    <button class="cell over"      (click)="toggleSort('overRate')"    role="columnheader" [attr.aria-sort]="ariaSort('overRate')">Over%</button>
    <button class="cell avgdelta"  (click)="toggleSort('avgDelta')"    role="columnheader" [attr.aria-sort]="ariaSort('avgDelta')">Avg Δ $</button>
    <button class="cell avgpct"    (click)="toggleSort('avgDeltaPct')" role="columnheader" [attr.aria-sort]="ariaSort('avgDeltaPct')">Avg Δ %</button>
    <button class="cell ship"      (click)="toggleSort('shipments')"   role="columnheader" [attr.aria-sort]="ariaSort('shipments')">Shipments</button>
    <button class="cell avgdays"   (click)="toggleSort('avgDeltaDays')" role="columnheader" [attr.aria-sort]="ariaSort('avgDeltaDays')">Avg Δ Days</button>
  </div>

  <div
    *ngFor="let m of rows; let i = index; trackBy: trackByCarrier"
    class="row body"
    role="row"
    (click)="store.selectCarrier(m.carrierId)"
    [class.selected]="m.carrierId === store.selectedCarrierId()">
    <div class="cell rank" role="cell">{{ rank(i) }}</div>
    <div class="cell carrier" role="cell">{{ m.carrierName }}</div>
    <div class="cell type" role="cell">{{ m.truckType }}</div>
    <div class="cell quotes" role="cell">{{ m.cost.quoteCount | number }}</div>
    <div class="cell over" role="cell">
      {{ (m.cost.overRate != null ? m.cost.overRate : 0) | percent:'1.0-1' }}
    </div>
    <div class="cell avgdelta" role="cell">{{ m.cost.avgDelta | number:'1.2-2' }}</div>
    <div class="cell avgpct" role="cell">{{ m.cost.avgDeltaPct | percent:'1.1-1' }}</div>
    <div class="cell ship" role="cell">{{ m.service.shipments | number }}</div>
    <div class="cell avgdays" role="cell">{{ m.service.avgDeltaDays | number:'1.2-2' }}</div>
  </div>

  <div *ngIf="rows.length === 0" class="empty">No carriers match your filter.</div>
</div>
